<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>NMS Logbook • Planet Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #020513;
  --panel: rgba(4, 12, 30, 0.96);
  --border: rgba(0, 200, 255, 0.6);
  --accent: #4cd8ff;
  --text: #e5f8ff;
  --error: #ff8484;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: radial-gradient(circle at 0 0, #142541, transparent 60%),
              radial-gradient(circle at 100% 100%, #081224, transparent 55%),
              var(--bg);
  font-family: "Orbitron", sans-serif;
  color: var(--text);
  display: flex;
  justify-content: center;
  padding: 30px 10px;
}

.panel {
  width: min(1100px, 100%);
  background: var(--panel);
  border-radius: 26px;
  border: 1px solid var(--border);
  padding: 30px;
  box-shadow: 0 0 36px #00eaff50;
  position: relative;
}

h1 {
  text-align: center;
  font-size: 24px;
  letter-spacing: 0.25em;
  margin-bottom: 5px;
  color: var(--accent);
}

.subtitle {
  text-align: center;
  font-size: 10px;
  opacity: 0.7;
  margin-bottom: 20px;
}

.logout-btn {
  position: absolute;
  top: 15px;
  right: 20px;
  padding: 6px 16px;
  font-size: 10px;
  border-radius: 20px;
  background: #350000;
  color: #ffb3b3;
  border: 1px solid #ff5f5f;
  cursor: pointer;
}

/* CAPTAIN PHOTO */
.captain-wrapper {
  width: 150px;
  margin: 10px auto 25px auto;
  text-align: center;
}

.photo-box {
  width: 150px;
  height: 150px;
  background: #000;
  border-radius: 14px;
  border: 2px solid var(--accent);
  box-shadow: 0 0 20px #00eaff80;
  overflow: hidden;
  cursor: pointer;
  transition: 0.2s;
}

.photo-box:hover {
  transform: scale(1.03);
  box-shadow: 0 0 25px #00eaffaa;
}

.photo-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* FORM GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px 20px;
}

.grid .full {
  grid-column: 1 / -1;
}

label {
  font-size: 9px;
  letter-spacing: 0.15em;
  opacity: 0.8;
}

input[type="text"],
textarea {
  width: 100%;
  padding: 8px 12px;
  background: rgba(0,0,0,0.6);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 12px;
}

textarea {
  min-height: 80px;
}

/* CATEGORY */
.category-block {
  border: 1px solid var(--border);
  padding: 12px;
  border-radius: 16px;
  margin-top: 18px;
}

.cat-title {
  letter-spacing: 0.15em;
  font-size: 12px;
  margin-bottom: 8px;
}

.add-btn {
  float: right;
  padding: 4px 12px;
  border: 1px solid var(--accent);
  color: var(--accent);
  border-radius: 20px;
  font-size: 10px;
  cursor: pointer;
}

.entry-box {
  display: flex;
  gap: 12px;
  background: rgba(0,0,0,0.4);
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: 1px solid var(--border);
}

.entry-photo {
  width: 120px;
  height: 90px;
  background: #000;
  border-radius: 10px;
  border: 1px solid var(--accent);
  cursor: pointer;
  overflow: hidden;
}

.entry-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.remove-btn {
  background: #350000;
  color: #ffb3b3;
  border: 1px solid #ff5f5f;
  border-radius: 18px;
  padding: 4px 12px;
  font-size: 10px;
  cursor: pointer;
  height: 22px;
  align-self: center;
}

/* LIGHTBOX */
.lightbox {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 99999;
}

.lightbox img {
  max-width: 90vw;
  max-height: 90vh;
  border-radius: 14px;
  border: 2px solid var(--accent);
  box-shadow: 0 0 40px #00eaff;
}
</style>
</head>
<body>

<div class="panel">

<button class="logout-btn" onclick="logout()">LOG OUT</button>

<h1>PLANET ADMIN</h1>
<div class="subtitle">NO MAN'S SKY • SHIP LOG • RECORD</div>

<!-- CAPTAIN PHOTO -->
<div class="captain-wrapper">
  <div class="photo-box" id="captainBox">
    <img src="media/captain.png" id="captainImg" class="photo-img">
  </div>
  <input type="file" id="captainInput" accept="image/*" hidden>
</div>

<form id="planetForm" class="grid" onsubmit="savePlanet(event)">

  <div><label>Planet</label><input id="name"></div>
  <div><label>Galaxy</label><input id="galaxy"></div>
  <div><label>System</label><input id="system"></div>

  <div><label>Biome</label><input id="biome"></div>
  <div><label>Weather</label><input id="weather"></div>
  <div><label>Temperature</label><input id="temp"></div>

  <div><label>Hazards</label><input id="hazard"></div>
  <div><label>Sentinels</label><input id="sentinels"></div>
  <div><label>Fauna Count</label><input id="faunacount"></div>

  <div class="full"><label>Flora Count</label><input id="flora"></div>

  <div class="full"><label>Resources Summary</label><input id="resources"></div>

  <div class="full">
    <label>Description</label>
    <textarea id="desc"></textarea>
  </div>
</form>

<!-- ANIMALS -->
<div class="category-block">
  <span class="cat-title">ANIMALS</span>
  <button class="add-btn" onclick="addEntry('animals')">+ ADD</button>
  <div id="animals"></div>
</div>

<!-- PLANTS -->
<div class="category-block">
  <span class="cat-title">PLANTS</span>
  <button class="add-btn" onclick="addEntry('plants')">+ ADD</button>
  <div id="plants"></div>
</div>

<!-- RESOURCES -->
<div class="category-block">
  <span class="cat-title">RESOURCES</span>
  <button class="add-btn" onclick="addEntry('resourcesList')">+ ADD</button>
  <div id="resourcesList"></div>
</div>

<!-- HAZARDS -->
<div class="category-block">
  <span class="cat-title">HAZARDS</span>
  <button class="add-btn" onclick="addEntry('hazardsList')">+ ADD</button>
  <div id="hazardsList"></div>
</div>

<!-- SAVE BUTTON -->
<div style="text-align:center; margin-top:20px;">
  <button onclick="savePlanet(event)"
    style="padding:14px 46px; border-radius:999px; border:2px solid var(--accent);
           background:linear-gradient(135deg,#05101f,#0a2a4f); color:#34d2ff;
           letter-spacing:0.25em; cursor:pointer;">
    SAVE ENTRY
  </button>
</div>

<div id="status" style="text-align:center;margin-top:10px;font-size:14px;"></div>

</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <img id="lightboxImg">
</div>

<script>
// ---------------------- LOGIN PROTECTION -----------------------
if (localStorage.getItem("isAdmin") !== "true") {
  window.location.href = "login.html";
}

function logout() {
  localStorage.removeItem("isAdmin");
  window.location.href = "login.html";
}

// ---------------------- CAPTAIN PHOTO ---------------------------
const captainBox = document.getElementById("captainBox");
const captainImg = document.getElementById("captainImg");
const captainInput = document.getElementById("captainInput");

captainBox.onclick = () => captainInput.click();

captainBox.ondblclick = () => openLightbox(captainImg.src);

captainInput.onchange = function () {
  const file = this.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => captainImg.src = e.target.result;
  reader.readAsDataURL(file);
};

// ---------------------- ENTRY TEMPLATES -------------------------
function addEntry(category) {
  const container = document.getElementById(category);

  const wrapper = document.createElement("div");
  wrapper.className = "entry-box";

  const photo = document.createElement("div");
  photo.className = "entry-photo";
  const img = document.createElement("img");
  img.src = "";
  photo.appendChild(img);

  const hiddenInput = document.createElement("input");
  hiddenInput.type = "file";
  hiddenInput.accept = "image/*";
  hiddenInput.hidden = true;

  photo.onclick = () => hiddenInput.click();

  photo.ondblclick = () => { if (img.src) openLightbox(img.src); };

  hiddenInput.onchange = function () {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => img.src = e.target.result;
    reader.readAsDataURL(file);
  };

  const desc = document.createElement("textarea");
  desc.placeholder = "Description...";
  desc.style.flex = "1";
  desc.style.height = "90px";
  desc.style.background = "rgba(0,0,0,0.5)";
  desc.style.color = "var(--text)";
  desc.style.border = "1px solid var(--border)";
  desc.style.borderRadius = "8px";
  desc.style.padding = "6px";

  const removeBtn = document.createElement("button");
  removeBtn.className = "remove-btn";
  removeBtn.innerText = "REMOVE";
  removeBtn.onclick = () => wrapper.remove();

  wrapper.appendChild(photo);
  wrapper.appendChild(desc);
  wrapper.appendChild(removeBtn);
  wrapper.appendChild(hiddenInput);

  container.appendChild(wrapper);
}

// ---------------------- LIGHTBOX -------------------------
function openLightbox(src) {
  const lb = document.getElementById("lightbox");
  const img = document.getElementById("lightboxImg");
  img.src = src;
  lb.style.display = "flex";
}

function closeLightbox() {
  document.getElementById("lightbox").style.display = "none";
}

// ---------------------- SAVE -------------------------
const STORAGE_KEY = "nms_planets_archive_v1";

function savePlanet(e) {
  e.preventDefault();
  const status = document.getElementById("status");

  let list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  const data = {
    id: Date.now(),
    name: name.value,
    galaxy: galaxy.value,
    system: system.value,
    biome: biome.value,
    weather: weather.value,
    temp: temp.value,
    hazard: hazard.value,
    sentinels: sentinels.value,
    faunacount: faunacount.value,
    flora: flora.value,
    resources: resources.value,
    desc: desc.value,
    captain: captainImg.src,
    animals: extract("animals"),
    plants: extract("plants"),
    resourcesList: extract("resourcesList"),
    hazardsList: extract("hazardsList"),
    createdAt: new Date().toISOString()
  };

  list.push(data);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

  status.innerHTML = "✔ SAVED";
  status.style.color = "#9effc0";
}

function extract(category) {
  const items = [];
  document.querySelectorAll(`#${category} .entry-box`).forEach(box => {
    const img = box.querySelector("img").src;
    const desc = box.querySelector("textarea").value;
    items.push({ img, desc });
  });
  return items;
}
</script>

</body>
</html>
