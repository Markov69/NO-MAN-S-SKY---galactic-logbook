<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>No Mean's Sky ‚Ä¢ Planet Archive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* === –ë–ê–ó–ê / –§–û–ù –ù–ê –°–¢–†–ê–ù–ò–¶–ê–¢–ê === */
        body {
            margin: 0;
            padding: 30px 0;
            font-family: "Orbitron", system-ui, sans-serif;
            background: #080406;
            color: #ffe7c9;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .left-image,
        .right-image {
            position: fixed;
            top: 0;
            height: 100vh;
            width: auto;
            opacity: .92;
            z-index: -1;
            pointer-events: none;
        }

        .left-image {
            left: 0;
        }

        .right-image {
            right: 0;
        }

        /* === –¶–ï–ù–¢–†–ê–õ–ù–ê –ó–û–ù–ê === */
        .shell {
            width: 690px;
            padding: 0 10px 30px 10px;
            position: relative;
            z-index: 20;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 14px;
            font-size: 11px;
            letter-spacing: .16em;
            text-transform: uppercase;
            color: #ffe3c4;
            text-decoration: none;
            border-bottom: 1px dashed rgba(255, 180, 120, .7);
            padding-bottom: 2px;
        }

            .back-link:hover {
                color: #fff;
                border-color: #fff;
            }

        .title {
            text-align: center;
            font-size: 30px;
            letter-spacing: .28em;
            margin-bottom: 4px;
            color: #ffdcb0;
            text-shadow: 0 0 16px #ffae60, 0 0 32px rgba(255, 120, 40, .85);
        }

        .subtitle {
            text-align: center;
            font-size: 12px;
            letter-spacing: .18em;
            margin-bottom: 18px;
            color: rgba(255, 220, 180, .75);
        }

        .cards-scroll {
            max-height: calc(100vh - 140px);
            overflow-y: auto;
            padding-right: 6px;
            scrollbar-width: thin;
            scrollbar-color: #ffb066 rgba(50, 20, 5, 0.6);
        }

            .cards-scroll::-webkit-scrollbar {
                width: 8px;
            }

            .cards-scroll::-webkit-scrollbar-track {
                background: rgba(50, 20, 5, 0.6);
            }

            .cards-scroll::-webkit-scrollbar-thumb {
                background: #ffb066;
                border-radius: 10px;
            }

        .cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 22px;
        }

        .card {
            background: rgba(22, 9, 3, .92);
            border-radius: 18px;
            border: 1px solid rgba(255, 160, 60, .7);
            padding: 12px;
            cursor: pointer;
            transition: .25s;
            box-shadow: 0 0 20px rgba(255, 140, 40, .22);
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }

            .card:hover {
                transform: translateY(-3px);
                box-shadow: 0 0 26px rgba(255, 160, 80, .55), 0 0 60px rgba(255, 90, 20, .4);
            }

        .card-img {
            width: 120px;
            height: 120px;
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(255, 160, 80, .9);
            box-shadow: 0 0 10px rgba(255, 160, 80, .8);
            flex-shrink: 0;
        }

            .card-img img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .card-info {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 4px;
        }

        .card-name {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: .14em;
            text-transform: uppercase;
            color: #ffe2bf;
            margin-bottom: 6px;
        }

        .card-line {
            font-size: 11px;
            opacity: .85;
            margin-bottom: 4px;
        }

            .card-line strong {
                color: #ffd6a0;
                font-weight: 700;
            }

        /* === POPUP === */
        .planet-popup {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .85);
            backdrop-filter: blur(6px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9000;
            overflow: hidden;
        }

        #radarCanvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .popup-card {
            background: rgba(20, 8, 2, .96);
            border: 1px solid rgba(255, 150, 60, .7);
            width: min(900px, 92%);
            max-height: 92vh;
            overflow-y: auto;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(255, 150, 60, .5), 0 0 120px rgba(255, 90, 20, .6);
            position: relative;
            color: #ffe7c9;
        }

        .popup-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(70, 0, 0, .8);
            border: 1px solid rgba(255, 90, 90, .9);
            padding: 6px 12px;
            border-radius: 999px;
            color: #ffb0b0;
            cursor: pointer;
            font-size: 11px;
            letter-spacing: .14em;
            text-transform: uppercase;
        }

        /* === –∫–∞–ø–∏—Ç–∞–Ω –≥–æ—Ä–µ –≤–ª—è–≤–æ === */
        .popup-captain {
            position: absolute;
            top: 18px;
            left: 18px;
            width: 110px;
            height: 110px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid #ffb347;
            box-shadow: 0 0 18px rgba(255, 160, 80, .7);
            margin: 0;
        }

        /* === —Ç–µ–∫—Å—Ç–æ–≤ –±–ª–æ–∫ –¥–æ –∫–∞–ø–∏—Ç–∞–Ω–∞ === */
        .captain-info-box {
            position: absolute;
            top: 24px;
            left: 140px;
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 180, 120, .55);
            background: radial-gradient(circle at 0 0, rgba(255, 200, 140, 0.18), transparent 65%);
            font-size: 11px;
            max-width: 420px;
        }

        .captain-info-row {
            display: flex;
            justify-content: flex-start;
            gap: 6px;
            margin-bottom: 4px;
        }

        .captain-info-label {
            text-transform: uppercase;
            letter-spacing: .14em;
            opacity: .8;
            min-width: 130px;
        }

        .captain-info-value {
            font-weight: 700;
            color: #ffe9c9;
        }

        .popup-title {
            text-align: center;
            font-size: 26px;
            letter-spacing: .25em;
            margin-top: 140px; /* –∑–∞—Ä–∞–¥–∏ –∫–∞–ø–∏—Ç–∞–Ω—Å–∫–∞—Ç–∞ —Å–Ω–∏–º–∫–∞ */
            color: #ffdcb4;
            text-transform: uppercase;
        }

        .popup-sub {
            text-align: center;
            font-size: 12px;
            opacity: .7;
            margin-bottom: 20px;
        }

        .popup-section {
            margin-bottom: 18px;
        }

        .popup-section-title {
            font-size: 13px;
            letter-spacing: .16em;
            text-transform: uppercase;
            margin-bottom: 8px;
            color: #ffdcb4;
        }

        /* OVERVIEW GRID */
        .info-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255, 150, 80, .35);
            background: radial-gradient(circle at 0 0, rgba(255, 180, 100, .18), transparent 55%);
            font-size: 12px;
            transition: .18s;
        }

            .info-row:hover {
                border-color: #fff;
                box-shadow: 0 0 14px rgba(255, 200, 140, .9), 0 0 30px rgba(255, 140, 60, .75);
                background: radial-gradient(circle at 50% 50%, rgba(255, 230, 180, .16), rgba(60, 20, 4, .95));
            }

        .info-label {
            opacity: .85;
            text-transform: uppercase;
            letter-spacing: .12em;
        }

        .info-value {
            font-weight: 700;
            color: #ffe9c9;
        }

        .popup-desc {
            background: rgba(255, 160, 80, .06);
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 150, 80, .4);
            font-size: 13px;
            line-height: 1.4;
        }

        /* ACCORDION */
        .acc-section {
            margin-bottom: 18px;
        }

        .acc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: rgba(255, 160, 80, .08);
            border: 1px solid rgba(255, 160, 80, .4);
            border-radius: 12px;
            cursor: pointer;
            transition: .2s;
        }

            .acc-header:hover {
                background: rgba(255, 160, 80, .16);
                border-color: #fff;
            }

        .acc-title {
            font-size: 13px;
            letter-spacing: .16em;
            color: #ffdcb4;
            text-transform: uppercase;
        }

        .acc-arrow {
            font-size: 14px;
            transition: .2s;
        }

        .acc-body {
            display: none;
            padding: 10px 4px 4px 4px;
        }

        .entry-holo {
            display: flex;
            gap: 12px;
            background: rgba(255, 150, 60, .06);
            border: 1px solid rgba(255, 150, 80, .4);
            padding: 8px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

            .entry-holo img {
                width: 90px;
                height: 90px;
                border-radius: 10px;
                object-fit: cover;
                border: 1px solid #ffb347;
                cursor: pointer;
                box-shadow: 0 0 12px rgba(255, 160, 80, .7);
            }

        /* Gallery */
        .gallery img {
            width: 300px;
            height: 300px;
            object-fit: cover;
            border-radius: 12px;
            border: 1px solid #ffb347;
            box-shadow: 0 0 12px rgba(255, 60, 80, .5);
            margin: 5px;
            cursor: pointer;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .btn-delete {
            background: rgba(80, 0, 0, .9);
            border: 1px solid rgba(255, 80, 80, .9);
            color: #ffb0b0;
            padding: 10px 24px;
            border-radius: 999px;
            cursor: pointer;
            font-size: 11px;
            letter-spacing: .18em;
            text-transform: uppercase;
            box-shadow: 0 0 16px rgba(255, 60, 60, .9);
        }

            .btn-delete:hover {
                background: rgba(150, 0, 0, 1);
                border-color: #ffdddd;
                color: #fff;
            }

        .btn-close {
            background: rgba(40, 15, 4, .8);
            border: 1px solid #ffb347;
            color: #ffdcb4;
            padding: 10px 24px;
            border-radius: 999px;
            cursor: pointer;
            font-size: 11px;
            letter-spacing: .18em;
            text-transform: uppercase;
        }

        .zoom-layer {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

            .zoom-layer img {
                max-width: 90vw;
                max-height: 90vh;
                border-radius: 12px;
                border: 2px solid #ffb347;
            }
    </style>
</head>
<body>

    <img class="left-image" src="media/LEFT.png">
    <img class="right-image" src="media/RIGHT.png">

    <div class="shell">
        <a href="index.html" class="back-link">‚üµ BACK</a>
        <div class="title">PLANET ARCHIVE</div>
        <div class="subtitle">PERSONAL EXPLORER DIARY</div>

        <div class="cards-scroll">
            <div id="cards" class="cards"></div>
            <div id="empty" style="display:none;text-align:center;margin-top:40px;font-size:13px;">
                –ù—è–º–∞ –∑–∞–ø–∏—Å–∏.
            </div>
        </div>
    </div>

    <div id="fullView" class="planet-popup">
        <canvas id="radarCanvas"></canvas>

        <div class="popup-card">

            <div class="popup-close" onclick="closeFull()">CLOSE</div>

            <!-- –°–ù–ò–ú–ö–ê –ù–ê –ö–ê–ü–ò–¢–ê–ù–ê -->
            <img id="popupCaptain" class="popup-captain">

            <!-- –ò–ù–§–û –ó–ê –ö–ê–ü–ò–¢–ê–ù–ê –î–û –°–ù–ò–ú–ö–ê–¢–ê -->
            <div class="captain-info-box">
                <div class="captain-info-row">
                    <div class="captain-info-label">CAPTAIN NAME</div>
                    <div class="captain-info-value" id="capName"></div>
                </div>
                <div class="captain-info-row">
                    <div class="captain-info-label">CAPTAIN AGE</div>
                    <div class="captain-info-value" id="capAge"></div>
                </div>
                <div class="captain-info-row">
                    <div class="captain-info-label">ORIGIN PLANET</div>
                    <div class="captain-info-value" id="capOrigin"></div>
                </div>
                <div class="captain-info-row">
                    <div class="captain-info-label">PROTOCOL TIME</div>
                    <div class="captain-info-value" id="capProtocol"></div>
                </div>
            </div>

            <!-- –ù–ê–î–ü–ò–°–ò–¢–ï ‚Äî –ü–û–î –°–ù–ò–ú–ö–ê–¢–ê, –ü–†–ï–î–ò PHOTOS -->
            <div class="popup-title" id="popupName"></div>
            <div class="popup-sub" id="popupSub"></div>

            <!-- PHOTOS -->
            <div class="popup-section">
                <div class="popup-section-title">PLANET PHOTOS</div>
                <div class="gallery" id="popupGallery"></div>
            </div>

            <!-- OVERVIEW -->
            <div class="popup-section">
                <div class="popup-section-title">OVERVIEW</div>
                <div class="info-grid">
                    <div class="info-row"><div class="info-label">üåç BIOME</div><div class="info-value" id="infoBiome"></div></div>
                    <div class="info-row"><div class="info-label">üå° TEMP</div><div class="info-value" id="infoTemp"></div></div>
                    <div class="info-row"><div class="info-label">‚ò£ HAZARDS</div><div class="info-value" id="infoHazards"></div></div>
                    <div class="info-row"><div class="info-label">üå± FLORA</div><div class="info-value" id="infoFlora"></div></div>
                    <div class="info-row"><div class="info-label">üêæ FAUNA</div><div class="info-value" id="infoFauna"></div></div>
                    <div class="info-row"><div class="info-label">‚õè RESOURCES</div><div class="info-value" id="infoResources"></div></div>
                </div>
            </div>

            <!-- DESCRIPTION -->
            <div class="popup-section">
                <div class="popup-section-title">DESCRIPTION</div>
                <div class="popup-desc" id="infoDesc"></div>
            </div>

            <!-- ACCORDION -->
            <div class="acc-section">
                <div class="acc-header" onclick="toggleAcc('accAnimals')">
                    <div class="acc-title">üêæ ANIMALS</div>
                    <div class="acc-arrow" id="arrowAccAnimals">‚ñæ</div>
                </div>
                <div class="acc-body" id="accAnimals" style="display:block;"></div>
            </div>

            <div class="acc-section">
                <div class="acc-header" onclick="toggleAcc('accPlants')">
                    <div class="acc-title">üåø PLANTS</div>
                    <div class="acc-arrow" id="arrowAccPlants">‚ñ∏</div>
                </div>
                <div class="acc-body" id="accPlants"></div>
            </div>

            <div class="acc-section">
                <div class="acc-header" onclick="toggleAcc('accResources')">
                    <div class="acc-title">‚õè RESOURCES</div>
                    <div class="acc-arrow" id="arrowAccResources">‚ñ∏</div>
                </div>
                <div class="acc-body" id="accResources"></div>
            </div>

            <div class="acc-section">
                <div class="acc-header" onclick="toggleAcc('accHazards')">
                    <div class="acc-title">‚ö† HAZARDS</div>
                    <div class="acc-arrow" id="arrowAccHazards">‚ñ∏</div>
                </div>
                <div class="acc-body" id="accHazards"></div>
            </div>

            <div style="text-align:center; margin-top:20px;">
                <button class="btn-delete" id="deleteBtn">DELETE</button>
                <button class="btn-close" onclick="closeFull()">CLOSE</button>
            </div>

        </div>
    </div>

    <!-- ZOOM -->
    <div id="zoomLayer" class="zoom-layer" onclick="closeZoom()">
        <img id="zoomImg">
    </div>

    <script>
        const KEY = "nms_planets_archive_v1";
        let planets = loadPlanets();
        const isAdmin = localStorage.getItem("isAdmin") === "true";

        function loadPlanets() {
            try {
                const raw = localStorage.getItem(KEY);
                return raw ? JSON.parse(raw) : [];
            } catch { return []; }
        }

        const cards = document.getElementById("cards");
        const empty = document.getElementById("empty");
        if (!planets.length) empty.style.display = "block";

        planets.slice().sort((a, b) => b.id - a.id).forEach(p => {
            const card = document.createElement("div");
            card.className = "card";
            card.onclick = () => openFull(p);
            const img = (p.images && p.images.length > 0) ? p.images[0] : "media/captain.png";
            card.innerHTML = `
                    <div class="card-img"><img src="${img}"></div>
                    <div class="card-info">
                        <div class="card-name">${p.name || "UNDEFINED"}</div>
                        <div class="card-line"><strong>Galaxy:</strong> ${p.galaxy || "-"}</div>
                        <div class="card-line"><strong>System:</strong> ${p.system || "-"}</div>
                        <div class="card-line"><strong>Weather:</strong> ${p.weather || "-"}</div>
                        <div class="card-line"><strong>Temp:</strong> ${p.temp || "-"}</div>
                        <div class="card-line"><strong>Hazard:</strong> ${p.hazard || "-"}</div>
                    </div>`;
            cards.appendChild(card);
        });

        function renderList(list, box) {
            box.innerHTML = "";
            if (!list || !list.length) return;
            list.forEach(e => {
                const img = e.img || "media/captain.png";
                box.innerHTML += `
                        <div class="entry-holo">
                            <img src="${img}" onclick="zoom('${img}')">
                            <div>
                                <div><b>${e.name || ""}</b></div>
                                <div style="opacity:.8;font-size:11px;">${e.desc || ""}</div>
                            </div>
                        </div>`;
            });
        }

        /* ======================
             RADAR ENGINE
           ====================== */

        let radarInitialized = false;
        let rCanvas, rCtx, rW, rH, rCX, rCY, rRadius, rSweep = 0, rTargets = [];

        function initRadar() {
            if (radarInitialized) return;
            rCanvas = document.getElementById("radarCanvas");
            if (!rCanvas) return;
            rCtx = rCanvas.getContext("2d");

            function resizeRadar() {
                const popup = document.getElementById("fullView");
                rCanvas.width = popup.clientWidth;
                rCanvas.height = popup.clientHeight;
                rW = rCanvas.width;
                rH = rCanvas.height;
                rCX = rW / 2;
                rCY = rH / 2;
                rRadius = Math.min(rW, rH) * 0.35;
            }

            resizeRadar();
            window.addEventListener("resize", resizeRadar);

            rTargets = [];
            for (let i = 0; i < 9; i++) {
                rTargets.push({ r: Math.random() * rRadius * 0.9, angle: Math.random() * Math.PI * 2, lastPing: 0 });
            }

            function loop() {
                requestAnimationFrame(loop);
                if (!rCtx) return;
                rCtx.clearRect(0, 0, rW, rH);
                rSweep += 0.02; if (rSweep > Math.PI * 2) rSweep = 0;

                rCtx.save();
                rCtx.translate(rCX, rCY);

                rCtx.beginPath();
                rCtx.arc(0, 0, rRadius * 1.05, 0, Math.PI * 2);
                const baseGrad = rCtx.createRadialGradient(0, 0, 0, 0, 0, rRadius * 1.05);
                baseGrad.addColorStop(0, "#2b0e04");
                baseGrad.addColorStop(1, "#050103");
                rCtx.fillStyle = baseGrad;
                rCtx.fill();

                rCtx.lineWidth = 1;
                for (let i = 1; i <= 7; i++) {
                    rCtx.beginPath();
                    rCtx.strokeStyle = "rgba(255,150,70," + (0.10 + i * 0.05) + ")";
                    rCtx.arc(0, 0, (rRadius / 7) * i, 0, Math.PI * 2);
                    rCtx.stroke();
                }

                rCtx.save();
                rCtx.strokeStyle = "rgba(255,120,40,0.35)";
                rCtx.lineWidth = 1;
                for (let i = 0; i < 12; i++) {
                    const a = (Math.PI * 2 / 12) * i;
                    rCtx.beginPath();
                    rCtx.moveTo(Math.cos(a) * rRadius * 0.18, Math.sin(a) * rRadius * 0.18);
                    rCtx.lineTo(Math.cos(a) * rRadius, Math.sin(a) * rRadius);
                    rCtx.stroke();
                }
                rCtx.restore();

                const grd = rCtx.createRadialGradient(0, 0, 0, 0, 0, rRadius * 1.05);
                grd.addColorStop(0, "rgba(255,255,210,0.0)");
                grd.addColorStop(0.10, "rgba(255,230,170,0.9)");
                grd.addColorStop(1, "rgba(255,150,60,0.0)");

                rCtx.beginPath();
                rCtx.moveTo(0, 0);
                rCtx.arc(0, 0, rRadius * 1.05, rSweep - 0.35, rSweep + 0.03);
                rCtx.closePath();
                rCtx.fillStyle = grd;
                rCtx.globalCompositeOperation = "lighter";
                rCtx.fill();
                rCtx.globalCompositeOperation = "source-over";

                rCtx.beginPath();
                rCtx.arc(0, 0, 4, 0, Math.PI * 2);
                rCtx.fillStyle = "#ffe8b0";
                rCtx.fill();

                const now = performance.now();
                rTargets.forEach(tg => {
                    const x = Math.cos(tg.angle) * tg.r;
                    const y = Math.sin(tg.angle) * tg.r;

                    let diff = tg.angle - rSweep;
                    while (diff > Math.PI) diff -= Math.PI * 2;
                    while (diff < -Math.PI) diff += Math.PI * 2;
                    diff = Math.abs(diff);

                    const ping = diff < 0.28;
                    if (ping) tg.lastPing = now;

                    let pulse = 0;
                    const dt = now - tg.lastPing;
                    if (dt >= 0 && dt < 600) pulse = 1 - dt / 600;

                    const baseAlpha = 0.45 + 0.5 * pulse;
                    const size = 5 + pulse * 5;

                    rCtx.fillStyle = "rgba(255,210,150," + baseAlpha + ")";
                    rCtx.beginPath();
                    rCtx.rect(x - size / 2, y - size / 2, size, size);
                    rCtx.fill();
                });

                rCtx.restore();
            }

            radarInitialized = true;
            requestAnimationFrame(loop);
        }

        /* ======================================
                OPEN FULL PLANET VIEW
           ====================================== */

        function openFull(p) {
            document.getElementById("fullView").style.display = "flex";
            if (!radarInitialized) initRadar();

            document.getElementById("popupName").textContent = p.name;
            document.getElementById("popupSub").textContent = `${p.galaxy} ‚Ä¢ ${p.system}`;

            // CAPTAIN PHOTO
            document.getElementById("popupCaptain").src =
                localStorage.getItem("captainPhoto") || "media/captain.png";

            // CAPTAIN INFO ‚Äì –ø—ä—Ä–≤–æ –æ—Ç –ø–ª–∞–Ω–µ—Ç–∞—Ç–∞, –ø–æ—Å–ª–µ –æ—Ç localStorage, –ø–æ—Å–ª–µ "-"
            document.getElementById("capName").textContent =
                p.captainName || localStorage.getItem("captainName") || "-";

            document.getElementById("capAge").textContent =
                p.captainAge || localStorage.getItem("captainAge") || "-";

            document.getElementById("capOrigin").textContent =
                p.captainOrigin || localStorage.getItem("captainOrigin") || "-";

            // PROTOCOL TIME ‚Äì –∞–∫–æ –∏–º–∞ p.captainProtocol, –ø–æ–ª–∑–≤–∞–π –≥–æ, –∏–Ω–∞—á–µ createdAt
            let protocolText = "";
            if (p.captainProtocol) {
                protocolText = p.captainProtocol;
            } else if (p.createdAt) {
                const dt = new Date(p.createdAt);
                protocolText = dt.toLocaleDateString("bg-BG") + " / " +
                    dt.toLocaleTimeString("bg-BG", { hour: "2-digit", minute: "2-digit" });
            } else {
                protocolText = "-";
            }
            document.getElementById("capProtocol").textContent = protocolText;

            document.getElementById("infoBiome").textContent = p.biome || "-";
            document.getElementById("infoTemp").textContent = p.temp || "-";
            document.getElementById("infoHazards").textContent = p.hazard || "-";
            document.getElementById("infoFlora").textContent = p.floraCount || "-";
            document.getElementById("infoFauna").textContent = p.faunaCount || "-";
            document.getElementById("infoResources").textContent = p.resourcesSummary || "-";

            document.getElementById("infoDesc").innerHTML = (p.desc || "").replace(/\n/g, "<br>");

            renderList(p.animals, document.getElementById("accAnimals"));
            renderList(p.plants, document.getElementById("accPlants"));
            renderList(p.resourcesDetailed, document.getElementById("accResources"));
            renderList(p.hazardsDetailed, document.getElementById("accHazards"));

            const gal = document.getElementById("popupGallery");
            gal.innerHTML = "";
            if (p.images) p.images.forEach(img => {
                gal.innerHTML += `<img src="${img}" onclick="zoom('${img}')">`;
            });

            const del = document.getElementById("deleteBtn");
            if (isAdmin) {
                del.style.display = "inline-block";
                del.onclick = () => deletePlanet(p.id);
            } else {
                del.style.display = "none";
            }
        }

        function closeFull() {
            document.getElementById("fullView").style.display = "none";
        }

        function zoom(src) {
            document.getElementById("zoomImg").src = src;
            document.getElementById("zoomLayer").style.display = "flex";
        }

        function closeZoom() {
            document.getElementById("zoomLayer").style.display = "none";
        }

        function deletePlanet(id) {
            if (!confirm("Delete planet?")) return;
            planets = planets.filter(p => p.id !== id);
            localStorage.setItem(KEY, JSON.stringify(planets));
            closeFull();
            setTimeout(() => location.reload(), 200);
        }

        function toggleAcc(id) {
            const body = document.getElementById(id);
            const arrow = document.getElementById("arrow" + id.charAt(0).toUpperCase() + id.slice(1));
            if (body.style.display === "block") {
                body.style.display = "none";
                arrow.textContent = "‚ñ∏";
            } else {
                body.style.display = "block";
                arrow.textContent = "‚ñæ";
            }
        }
    </script>

</body>
</html>
