<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>No Mean's Sky – Ship Log LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0; padding:0;
  background:#02030b;
  color:#b7eaff;
  font-family:Orbitron, sans-serif;
  overflow:hidden;
}

/* STARFIELD */
.stars, .stars2{
  position:fixed; inset:0; pointer-events:none; z-index:-3;
}
.stars{
  background-image:
    radial-gradient(2px 2px at 20% 30%, #fff 0, transparent 40%),
    radial-gradient(1.5px 1.5px at 70% 80%, #cce8ff 0, transparent 40%);
  background-size:500px 500px;
  animation: drift1 60s linear infinite;
}
.stars2{
  background-image:
    radial-gradient(2px 2px at 50% 60%, #fff 0, transparent 40%),
    radial-gradient(1.5px 1.5px at 10% 20%, #b8eaff 0, transparent 40%);
  background-size:600px 600px;
  animation: drift2 85s linear infinite;
}
@keyframes drift1{ from{transform:translate(0,0)} to{transform:translate(-300px,-300px)} }
@keyframes drift2{ from{transform:translate(0,0)} to{transform:translate(300px,200px)} }

/* HOME PANEL */
.home{
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
  text-align:center;
}
h1{
  font-size:28px;
  letter-spacing:0.25em;
  color:#9fe7ff;
}
.sub{
  font-size:13px;
  opacity:0.7;
  letter-spacing:0.2em;
}

/* ENTER LOG BUTTON */
.enter-log-button a{
  display:inline-block;
  padding:12px 32px;
  border-radius:10px;
  border:1px solid rgba(120,220,255,0.5);
  background:rgba(10,25,40,0.55);
  color:#9fe7ff;
  letter-spacing:0.25em;
  text-decoration:none;
  transition:0.25s;
}
.enter-log-button a:hover{
  color:#fff;
  border-color:#d7f8ff;
  box-shadow:0 0 12px #81eaff;
  transform:translateY(-2px);
}

/* RADAR CANVAS WRAPPER */
.radar-wrapper{
  width:300px;
  height:300px;
  display:flex;
  align-items:center;
  justify-content:center;
}
#radarCanvas{
  width:100%;
  height:100%;
  display:block;
}

/* LOADING */
.loading-overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,0.75);
  backdrop-filter:blur(4px);
  display:flex; justify-content:center; align-items:center;
  z-index:9998;
}
.loading-box{text-align:center; color:#9fe7ff;}
.loading-bar-outer{
  width:240px;height:9px; background:rgba(255,255,255,0.08);
  border:1px solid rgba(140,230,255,0.4);
  border-radius:6px; margin:10px auto; overflow:hidden;
}
.loading-bar-inner{
  width:0%;height:100%;
  background:#34d2ff;
  box-shadow:0 0 12px #34d2ff;
  transition:0.25s linear;
}
.loading-percent{font-size:12px;opacity:0.7;letter-spacing:0.14em;}

/* LOG WINDOW (YOUTUBE LIVE) */
.log-screen{
  position:fixed; inset:0;
  background:rgba(0,10,20,0.35);
  backdrop-filter:blur(4px);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
  transition:transform .1s linear;
}
.log-window{
  width:900px; max-width:95%;
  height:520px; max-height:85%;
  border-radius:16px;
  border:1px solid rgba(120,210,255,0.45);
  box-shadow:0 0 22px rgba(120,210,255,0.45);
  position:relative;
  overflow:hidden;
  background:rgba(5,12,25,0.9);
}
.log-close{
  position:absolute; top:10px; right:16px;
  font-size:20px; cursor:pointer;
  opacity:.8; transition:.2s;
  z-index:10;
  color:#e0f6ff;
  text-shadow:0 0 8px #7fe2ff;
}
.log-close:hover{opacity:1;}

/* iframe вътре да пълни прозореца */
.log-window iframe{
  width:100%;
  height:100%;
  border:0;
  display:block;
}
</style>
</head>

<body>

<div class="stars"></div>
<div class="stars2"></div>

<div class="home">
  <h1>NO MEAN'S SKY</h1>
  <div class="sub">BORDOVI DNEVNIK / SHIP LOG</div>

  <div class="enter-log-button">
    <a href="#">ENTER LOG</a>
  </div>

  <div class="radar-wrapper">
    <canvas id="radarCanvas"></canvas>
  </div>
</div>

<script>
/* -------------------- RADAR ENGINE -------------------- */
(function(){
  const canvas=document.getElementById('radarCanvas');
  const dpr=window.devicePixelRatio||1;
  let ctx,size,center,radius;

  function resize(){
    const w=canvas.clientWidth,h=canvas.clientHeight;
    const s=Math.min(w,h);
    canvas.width=s*dpr; canvas.height=s*dpr;
    ctx=canvas.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0);
    size=s; center={x:s/2,y:s/2}; radius=s*0.45;
  }
  window.addEventListener('resize',resize);
  new ResizeObserver(resize).observe(canvas);
  resize();

  let sweep=0;
  const speed=Math.PI*0.25;
  const width=Math.PI/10;

  const targets=[];
  for(let i=0;i<6;i++){
    targets.push({
      rNorm:Math.random()*0.85+0.15,
      ang:Math.random()*Math.PI*2,
      ping:0
    });
  }

  function diff(a,b){
    let d=a-b;
    while(d>Math.PI)d-=2*Math.PI;
    while(d<-Math.PI)d+=2*Math.PI;
    return Math.abs(d);
  }

  function draw(t){
    requestAnimationFrame(draw);
    const dt=1/60;
    t=t/1000;
    sweep+=speed*dt;
    if(sweep>Math.PI*2)sweep-=Math.PI*2;

    ctx.clearRect(0,0,size,size);
    ctx.save();
    ctx.translate(center.x,center.y);

    // background
    let bg=ctx.createRadialGradient(0,0,0,0,0,radius*1.4);
    bg.addColorStop(0,"#2b1500");
    bg.addColorStop(1,"#050308");
    ctx.fillStyle=bg;
    ctx.fillRect(-radius*1.3,-radius*1.3,radius*2.6,radius*2.6);

    // main circle
    ctx.beginPath();
    ctx.arc(0,0,radius,0,Math.PI*2);
    ctx.fillStyle="#1a0702";
    ctx.fill();

    // rings
    ctx.strokeStyle="rgba(255,160,40,0.3)";
    for(let i=1;i<=6;i++){
      ctx.beginPath();
      ctx.arc(0,0,radius*(i/6),0,Math.PI*2);
      ctx.stroke();
    }

    // sweep
    ctx.save();
    ctx.globalCompositeOperation="lighter";
    let g=ctx.createRadialGradient(0,0,0,0,0,radius*1.1);
    g.addColorStop(0,"rgba(255,230,180,0)");
    g.addColorStop(0.1,"rgba(255,200,140,0.6)");
    g.addColorStop(1,"rgba(255,120,0,0)");
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius,sweep-width,sweep,false);
    ctx.closePath();
    ctx.fillStyle=g;
    ctx.fill();
    ctx.restore();

    // center dot
    ctx.beginPath();
    ctx.arc(0,0,4,0,Math.PI*2);
    ctx.fillStyle="#ffd8a0";
    ctx.fill();

    // targets
    ctx.globalCompositeOperation="lighter";
    for(const tr of targets){
      const r=radius*tr.rNorm;
      const a=tr.ang;
      const x=Math.cos(a)*r;
      const y=Math.sin(a)*r;

      const isPing= diff(a,sweep) < width*0.7;
      if(isPing) tr.ping=t;

      const d=t-tr.ping;
      let pulse=0;
      if(d>=0 && d<0.4) pulse=1-(d/0.4);

      // trail
      ctx.strokeStyle=`rgba(255,180,60,${0.3+0.4*pulse})`;
      ctx.lineWidth=2;
      ctx.beginPath();
      ctx.moveTo(x,y);
      ctx.lineTo(Math.cos(a)*radius,Math.sin(a)*radius);
      ctx.stroke();

      // marker
      const s=6+pulse*4;
      ctx.fillStyle=`rgba(255,200,140,${0.5+0.5*pulse})`;
      ctx.fillRect(x-s/2,y-s/2,s,s);

      // halo
      if(pulse>0){
        ctx.beginPath();
        ctx.arc(x,y,s+4,0,Math.PI*2);
        ctx.strokeStyle=`rgba(255,200,120,${0.4*pulse})`;
        ctx.stroke();
      }
    }

    ctx.restore();
  }
  requestAnimationFrame(draw);
})();

/* -------------------- LOG + YOUTUBE LIVE -------------------- */
document.addEventListener("DOMContentLoaded",()=>{
  const btn=document.querySelector(".enter-log-button a");
  let shown=false, move=null;

  history.replaceState({screen:"home"},"");

  btn.addEventListener("click",e=>{
    e.preventDefault();
    if(shown) return;
    startLoading();
  });

  function startLoading(){
    const ov=document.createElement("div");
    ov.className="loading-overlay";
    ov.innerHTML=`
      <div class="loading-box">
        <div>LOADING LIVE FEED...</div>
        <div class="loading-bar-outer"><div class="loading-bar-inner"></div></div>
        <div class="loading-percent">0%</div>
      </div>`;
    document.body.appendChild(ov);

    let p=0;
    function step(){
      p+=Math.floor(Math.random()*18)+5;
      if(p>100)p=100;
      ov.querySelector(".loading-bar-inner").style.width=p+"%";
      ov.querySelector(".loading-percent").textContent=p+"%";
      if(p<100) setTimeout(step,150+Math.random()*250);
      else setTimeout(()=>{ov.remove();openLog();},300);
    }
    step();
  }

  function openLog(){
    shown=true;
    history.pushState({screen:"log"},"","#log");

    const scr=document.createElement("div");
    scr.className="log-screen";
    scr.innerHTML=`
      <div class="log-window">
        <div class="log-close">✕</div>
        <iframe
          src="https://www.youtube.com/embed/live_stream?channel=UCUWj8BmiKxNBflpe-GnWUmw&autoplay=1"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>`;
    document.body.appendChild(scr);

    // parallax
    move=e=>{
      const x=(window.innerWidth/2-e.clientX)/40;
      const y=(window.innerHeight/2-e.clientY)/40;
      scr.style.transform=`translate(${x}px,${y}px)`;
    };
    document.addEventListener("mousemove",move);

    scr.querySelector(".log-close").onclick=()=>history.back();
  }

  function closeLog(){
    const scr=document.querySelector(".log-screen");
    if(scr) scr.remove();
    if(move) document.removeEventListener("mousemove",move);
    move=null; shown=false;
  }

  window.addEventListener("popstate",e=>{
    const s=e.state||{};
    if(s.screen==="home") closeLog();
  });
});
</script>

</body>
</html>
